/*
 Hype Reactive Content 1.7.1
copyright (c) 2025 Max Ziebell, (https://maxziebell.de). MIT-license
*/
'use strict';"HypeReactiveContent"in window===!1&&(window.HypeReactiveContent=function(){function F(a){(g("trackRedraws")||g("forceHighlightBindings"))&&(g("forceHighlightBindings")||z())&&requestAnimationFrame(()=>{if(a.isConnected){var b=a.getBoundingClientRect();if(b.width!==0||b.height!==0){var d=document.createElement("div");d.className="hype-reactive-redraw-overlay";d.style.position="absolute";d.style.pointerEvents="none";d.style.zIndex="9999";d.style.top=window.scrollY+b.top+"px";d.style.left=
window.scrollX+b.left+"px";d.style.width=b.width+"px";d.style.height=b.height+"px";document.body.appendChild(d);setTimeout(()=>{d&&d.parentNode&&d.parentNode.removeChild(d)},g("redrawHighlightDuration"))}}})}function z(){return window.location.href.indexOf("127.0.0.1:")!=-1&&window.location.href.indexOf("/preview/")!=-1}function G(a,b){typeof a=="object"?w=a:w[a]=b}function g(a){return a?w[a]:w}function A(a,b){return a?a+"."+b:b}function H(a,b){if(b&&typeof b==="object")for(const [d,e]of Object.entries(b))(b=
a[d])&&typeof b==="object"&&!Array.isArray(b)&&e&&typeof e==="object"&&!Array.isArray(e)?H(b,e):a[d]=e}function B(a,b,d){d=d||"";if(a==null||a[C])return a;var e=I.get(a);if(e)return e;e=new Proxy(a,{get:function(k,c,f){if(c==="_key")return d;if(c===C)return!0;k=Reflect.get(k,c,f);return typeof k==="object"?B(k,b,A(d,c)):k},set:function(k,c,f,l){const n=Reflect.set(k,c,f,l);b(c,f,k,l);return n}});I.set(a,e);return e}function J(a){if(!a[C])return a;const b={};for(const d in a)if(a.hasOwnProperty(d)){const e=
a[d];b[d]=typeof e==="object"?J(e):e}return b}function D(a){return function(){if(!a.timeout){var b=arguments;a.timeout=requestAnimationFrame(function(){a.apply(this,b);a.timeout=null}.bind(this))}}}function v(a,b,d,e){if(d){if(typeof d!=="object")return null}else{if(d===void 0)return null;d=b.customData}e=e||{};if("HypeActionEvents"in window!==!1)return b.triggerAction(a,{element:e.element,event:{type:e.type},scope:d});try{let k=new Proxy(Object.assign({element:e.element,$elm:e.element},b),{set(c,
f,l,n){return Reflect.get(c,f,n)?Reflect.set(c,f,l,n):Reflect.set(d,f,l)},get(c,f,l){return(c=Reflect.get(c,f,l))?c:Reflect.get(d,f)},has(c,f,l){return c.hasOwnProperty(f)||window[f]?Reflect.has(c,f,l):!0}});return(new Function("$context","with($context){ "+a+"}"))(k)}catch(k){g("debug")||z()?console.error("%c"+(e.errorMsg||"HypeReactiveContent Error")+"%c"+(e.errorMsg?"":" version "+HypeReactiveContent.version)+"\n\n%c"+a+(e.omitError?"":"%c\n\n"+k+"\n\n"),"font-size:12px; font-weight:bold","font-size:8px",
"min-height:40px;display: inline-block; padding: 10px; background-color: rgba(255,255,255,0.25); border: 1px solid lightgray; border-radius: 4px; font-family:Monospace; font-size:12px","font-size:11px",e.element?e.element:""):console.error(k)}}function K(a,b,d){return d?v("return "+d,a,null,{element:b,type:"HypeReactiveScope"}):null}function L(a,b){if(!b)return null;const d=b.closest("[data-scope]");if(d){const e=document.getElementById(a.documentId());if(e&&e.contains(d))return K(a,b,d.getAttribute("data-scope"))}return null}
function x(a,b,d){const e=g("scopeSymbol"),k=e.length;let c=null;a=a.trim();a.startsWith(e)?(a=a.slice(k),c=L(b,d)):a.includes(e)&&(c=a.slice(0,a.indexOf(e)),c=K(b,d,c),a=a.slice(a.indexOf(e)+k));return{value:a,scope:c}}function M(a,b,d){return a.replace(/{{([\s\S]*?)}}/g,function(e,k){k=k.trim();if(e.charAt(0)==="\\")return e.substring(1);try{const c=x(k,b,d);let f=v("return "+c.value,b,c.scope,{element:d,type:"HypeReactiveTemplate"});return f!==void 0?f:""}catch(c){return""}})}function O(a){let b=
document.getElementById(a.currentSceneId()),d=r.get(a)||new Map;b.querySelectorAll("[data-content-template]").forEach(function(e){const k=e.getAttribute("data-content-template"),c=e.innerHTML;k&&!d.has(k)?d.set(k,c):k||d.has(e)||d.set(e,c)});r.set(a,d)}function P(a){y.set(a,a.customData||{});Object.defineProperty(a,"customData",{get:function(){return y.get(a)},set:function(b){b=B(b,a.refreshReactiveContentDebounced);y.set(a,b);g("debounceCustomDataUpdate")?a.refreshReactiveContentDebounced():a.refreshReactiveContent()}})}
function Q(a,b,d){"HypeActionEvents"in window===!1&&(b=d.customBehaviorName,b.charAt(0)!="#"&&/[;=()]/.test(b)&&v(b,a,a.customData))}function N(){if(!u){var a=["[data-scope] [data-content*\x3d"+g("scopeSymbol")+"],[data-scope] [data-effect*\x3d"+g("scopeSymbol")+"],[data-scope] [data-visibility*\x3d"+g("scopeSymbol")+"]{--data-reactive-color: #ffcccc}","[data-content], [data-effect], [data-visibility], [data-content-template]{--data-reactive-color: #f8d54f}"];document.documentElement.style.setProperty("--data-reactive-color",
"#f8d54f");var b=g("forceHighlightBindings");if(b||g("highlightActionData"))a=a.concat(["[data-content]{outline:1px dashed var(--data-reactive-color);position:relative}","[data-content]::before{content:attr(data-content);font-family:Helvetica,Arial;line-height:11px;font-size:9px;font-weight:normal;padding:2px 5px;white-space:nowrap;max-height:16px;color:#000;text-align:center;background-color:var(--data-reactive-color);position:absolute;top:-15px;left:-1px;border-top-right-radius:.2rem;border-top-left-radius:.2rem;}",
"[data-effect]::before{content:'"+g("effectSymbol")+" ' attr(data-effect);font-family:Helvetica,Arial;line-height:11px;font-size:9px;font-weight:normal;padding:2px 5px;white-space:nowrap;max-height:16px;color:#000;text-align:center;background-color:var(--data-reactive-color);position:absolute;top:-15px;left:-1px;border-top-right-radius:.2rem;border-top-left-radius:.2rem;}","[data-content][data-effect]::before{content: attr(data-content) ' "+g("effectSymbol")+" ' attr(data-effect)}"]);if(b||g("highlightTemplateData"))a=
a.concat(["[data-content-template]{outline:1px dashed var(--data-reactive-color);position:relative}","[data-content-template]::before{content:'"+g("templateSymbol")+" ' attr(data-content-template);font-family:Helvetica,Arial;line-height:11px;font-size:9px;font-weight:normal;padding:2px 5px;white-space:nowrap;max-height:16px;color:#000;text-align:center;background-color:var(--data-reactive-color);position:absolute;top:-15px;left:-1px;border-top-right-radius:.2rem;border-top-left-radius:.2rem;}"]);
if(b||g("highlightVisibilityData"))a=a.concat(["[data-visibility]::before{content:'"+g("visibilitySymbol")+" ' attr(data-visibility);font-family:Helvetica,Arial;line-height:11px;font-size:9px;font-weight:normal;padding:2px 5px;white-space:nowrap;max-height:16px;color:#000;text-align:center;background-color:var(--data-reactive-color);position:absolute;top:-15px;left:-1px;border-top-right-radius:.2rem;border-top-left-radius:.2rem;}"]);if(b||g("highlightScopeData"))a=a.concat(["[data-scope]{--data-reactive-color:#ffcccc; outline:1px dashed var(--data-reactive-color);}",
"[data-scope]::after{content:attr(data-scope);font-family:Helvetica,Arial;line-height:11px;font-size:9px;font-weight:normal;padding:2px 5px;white-space:nowrap;max-height:16px;color:#000;text-align:center;background-color:var(--data-reactive-color);position:absolute;bottom:-15px;left:-1px;border-bottom-right-radius:.2rem;border-bottom-left-radius:.2rem}"]);(b||g("highlightActionData"))&&(b||g("highlightVisibilityData"))&&(a=a.concat(["[data-content][data-visibility]:not([data-effect])::before{content: attr(data-content) ' "+
g("visibilitySymbol")+" ' attr(data-visibility)}","[data-effect][data-visibility]:not([data-content])::before{content: ' "+g("effectSymbol")+" ' attr(data-effect) ' "+g("visibilitySymbol")+" ' attr(data-visibility)}","[data-content][data-effect][data-visibility]::before{content: attr(data-content)  ' "+g("effectSymbol")+" ' attr(data-effect) ' "+g("visibilitySymbol")+" ' attr(data-visibility)}"]));if(b||g("highlightVisibilityArea"))a=a.concat(["[data-visibility]:not([data-scope])::after {content:'';position: absolute;top: 0;left: 0;width: 100%;height: 100%;background-image:repeating-linear-gradient(45deg,transparent,transparent 10px,var(--data-reactive-color) 10px,var(--data-reactive-color) 20px);opacity: .1;}"]);
if(b)switch(a.push(".hype-reactive-redraw-overlay {box-sizing: border-box;background-color: rgba(255, 0, 0, 0.2);border: 1px solid rgba(255, 0, 0, 0.5);}"),g("visibilityMode")){case "auto":a.push('[data-visibility][style*\x3d"visibility: hidden"] [data-visibility] { visibility: hidden !important; }');break;case "manual":a.push('[style*\x3d"visibility: hidden"] .inheritVisibility { visibility: hidden !important; }','.propagateVisibility[data-visibility][style*\x3d"visibility: hidden"] [data-visibility] { visibility: hidden !important; }')}u=
document.createElement("style");u.id="hype-reactive-binding-highlights";u.textContent=a.join("\n");document.head.appendChild(u)}}const E=window.location.href.indexOf("/Hype/Scratch/HypeScratch.")!=-1,y=new WeakMap,I=new WeakMap;let w={scopeSymbol:"\u21e2",visibilitySymbol:"\ud83d\udc41\ufe0f",effectSymbol:"\u26a1\ufe0f",templateSymbol:"\ud83d\udcdd",debounceCustomDataUpdate:!0,visibilityMode:"auto",debug:!1,trackRedraws:!1,redrawHighlightDuration:250,forceHighlightBindings:!1};E&&Object.assign(w,
{highlightReactiveContent:!0,highlightVisibilityData:!0,highlightVisibilityArea:!0,highlightActionData:!0,highlightScopeData:!0,highlightTemplateData:!0});const C=Symbol("isProxy"),r=new WeakMap;"HYPE_eventListeners"in window===!1&&(window.HYPE_eventListeners=[]);window.HYPE_eventListeners.push({type:"HypeDocumentLoad",callback:function(a,b,d){function e(c,f,l,n,h){(n=c.closest("["+l+"-action]"))&&v(n.getAttribute(l+"-action"),a,null,{element:c,type:f});if((n=c.closest("["+l+"-behavior]"))&&!k[n.id]){k[n.id]=
!0;let m=n.getAttribute(l+"-behavior");D(function(){a.triggerCustomBehaviorNamed(m)})()}}let k={};a.refreshReactiveContent=function(c,f,l,n){c===void 0||f===void 0||/[;=()]/.test(f)||typeof f==="object"||a.triggerCustomBehaviorNamed(A(n._key,c)+" equals "+(typeof f==="string"?'"'+f+'"':f));c!==void 0&&(g("customDataUpdate")&&g("customDataUpdate")(c,f,l,n),a.customDataUpdate&&a.customDataUpdate(c,f,l,n),a.triggerCustomBehaviorNamed("customData was changed"),a.triggerCustomBehaviorNamed(A(n._key,c)+
" was updated"));f=document.getElementById(a.currentSceneId());k={};f.querySelectorAll("[data-visibility], [data-content], [data-effect], [data-content-template]").forEach(function(h){var m=h.getAttribute("data-content"),q=h.getAttribute("data-visibility"),p=h.getAttribute("data-effect"),t=h.hasAttribute("data-content-template");q&&(q=x(q,a,h),q=v("return "+q.value,a,q.scope,{element:h,type:"HypeReactiveVisibility"}),h.style.display=="none"&&(h.style.display="block"),q=q?"visible":"hidden",q!==h.style.visibility&&
(h.style.visibility=q,c&&e(h,"HypeReactiveVisibilityChanged","data-visibility-changed",!0,!0)));p&&(p=x(p,a,h),v(p.value,a,p.scope,{element:h,type:"HypeReactiveEffect"}));m?(m=x(m,a,h),m=v("return "+m.value,a,m.scope,{element:h,type:"HypeReactiveContent"}),m!==null&&(p=document.createElement("div"),(t=m instanceof HTMLElement||m instanceof DocumentFragment)?p.appendChild(m.cloneNode(!0)):(m=m!==void 0?m:"",p.innerHTML=m),p=p.innerHTML,p!==h.innerHTML&&(t?(h.innerHTML="",h.appendChild(m)):h.innerHTML=
p,F(h),c&&e(h,"HypeReactiveContentChanged","data-content-changed",!0,!0)))):t&&(m=h.getAttribute("data-content-template"),t=r.get(a)||new Map,(m=m?t.get(m):t.get(h))?(m=M(m,a,h),t=document.createElement("div"),t.innerHTML=m,m=t.innerHTML,m!==h.innerHTML&&(h.innerHTML=m,F(h),c&&e(h,"HypeReactiveTemplateChanged","data-content-template-changed",!0,!0))):h.innerHTML="")});"HypeDataMagic"in window!==!1&&HypeDataMagic.getDefault("refreshOnCustomData")&&a.refresh()};a.refreshReactiveContentDebounced=D(a.refreshReactiveContent);
a.resolveClosestScope=function(c){return L(a,c)};a.enableReactiveCustomData=function(c){const f=y.get(a)||{};H(f,c||{});a.customData=f};a.parseTemplate=function(c,f){return M(c,a,f||b)};a.setContentTemplateByName=function(c,f,l=!0){let n=r.get(a)||new Map;n.set(c,f);r.set(a,n);l&&a.refreshReactiveContentDebounced()};a.setContentTemplates=function(c,f=!0){if(c&&typeof c==="object"){for(let l in c)c.hasOwnProperty(l)&&a.setContentTemplateByName(l,c[l],!1);f&&a.refreshReactiveContentDebounced()}};a.flushContentTemplateByName=
function(c,f=!0){const l=r.get(a);l&&c&&(l.delete(c),r.set(a,l),f&&a.refreshReactiveContentDebounced())};a.flushContentTemplates=function(c=!0){const f=r.get(a);f&&(f.clear(),r.set(a,f),c&&a.refreshReactiveContentDebounced())};P(a);a.enableReactiveCustomData(g("customData")||{});a.functions().HypeReactiveContent&&a.functions().HypeReactiveContent(a,b,d)}});window.HYPE_eventListeners.push({type:"HypeScenePrepareForDisplay",callback:function(a,b,d){O(a);a.refreshReactiveContent()}});"HypeActionEvents"in
window===!1&&window.HYPE_eventListeners.push({type:"HypeTriggerCustomBehavior",callback:Q});let u=null;E&&window.addEventListener("DOMContentLoaded",function(a){g("highlightReactiveContent")&&N()});E||window.addEventListener("DOMContentLoaded",function(a){a=g("visibilityMode");let b=[];z()&&b.push(".hype-reactive-redraw-overlay {box-sizing: border-box;background-color: rgba(255, 0, 0, 0.2);border: 1px solid rgba(255, 0, 0, 0.5);}");switch(a){case "auto":b.push('[data-visibility][style*\x3d"visibility: hidden"] [data-visibility] { visibility: hidden !important; }');
break;case "manual":b.push('[style*\x3d"visibility: hidden"] .inheritVisibility { visibility: hidden !important; }','.propagateVisibility[data-visibility][style*\x3d"visibility: hidden"] [data-visibility] { visibility: hidden !important; }')}b.length&&b.forEach(d=>document.styleSheets[0].insertRule(d,0))});return{version:"1.7.1",setDefault:G,getDefault:g,enableReactiveObject:B,disableReactiveObject:J,debounceByRequestFrame:D,enableBindingHighlights:N,disableBindingHighlights:function(){u&&(u.remove(),
u=null);G("forceHighlightBindings",!1)}}}());
