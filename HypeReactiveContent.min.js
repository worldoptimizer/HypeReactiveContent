/*
 Hype Reactive Content 1.6.1
copyright (c) 2025 Max Ziebell, (https://maxziebell.de). MIT-license
*/
'use strict';!1==="HypeReactiveContent"in window&&(window.HypeReactiveContent=function(){function D(a){g("trackRedraws")&&y()&&requestAnimationFrame(()=>{if(a.isConnected){var c=a.getBoundingClientRect();if(0!==c.width||0!==c.height){var d=document.createElement("div");d.className="hype-reactive-redraw-overlay";d.style.position="absolute";d.style.pointerEvents="none";d.style.zIndex="9999";d.style.top=window.scrollY+c.top+"px";d.style.left=window.scrollX+c.left+"px";d.style.width=c.width+"px";d.style.height=
c.height+"px";document.body.appendChild(d);setTimeout(()=>{d&&d.parentNode&&d.parentNode.removeChild(d)},g("redrawHighlightDuration"))}}})}function y(){return-1!=window.location.href.indexOf("127.0.0.1:")&&-1!=window.location.href.indexOf("/preview/")}function g(a){return a?v[a]:v}function z(a,c){return a?a+"."+c:c}function A(a,c,d){d=d||"";if(null==a||a[B])return a;var f=E.get(a);if(f)return f;f=new Proxy(a,{get:function(k,b,e){if("_key"===b)return d;if(b===B)return!0;k=Reflect.get(k,b,e);return"object"===
typeof k?A(k,c,z(d,b)):k},set:function(k,b,e,l){const n=Reflect.set(k,b,e,l);c(b,e,k,l);return n}});E.set(a,f);return f}function F(a){if(!a[B])return a;const c={};for(const d in a)if(a.hasOwnProperty(d)){const f=a[d];c[d]="object"===typeof f?F(f):f}return c}function C(a){return function(){if(!a.timeout){var c=arguments;a.timeout=requestAnimationFrame(function(){a.apply(this,c);a.timeout=null}.bind(this))}}}function u(a,c,d,f){if(d){if("object"!==typeof d)return null}else{if(void 0===d)return null;
d=c.customData}f=f||{};if(!1!=="HypeActionEvents"in window)return c.triggerAction(a,{element:f.element,event:{type:f.type},scope:d});try{let k=new Proxy(Object.assign({element:f.element,$elm:f.element},c),{set(b,e,l,n){return Reflect.get(b,e,n)?Reflect.set(b,e,l,n):Reflect.set(d,e,l)},get(b,e,l){return(b=Reflect.get(b,e,l))?b:Reflect.get(d,e)},has(b,e,l){return b.hasOwnProperty(e)||window[e]?Reflect.has(b,e,l):!0}});return(new Function("$context","with($context){ "+a+"}"))(k)}catch(k){g("debug")||
y()?console.error("%c"+(f.errorMsg||"HypeReactiveContent Error")+"%c"+(f.errorMsg?"":" version "+HypeReactiveContent.version)+"\n\n%c"+a+(f.omitError?"":"%c\n\n"+k+"\n\n"),"font-size:12px; font-weight:bold","font-size:8px","min-height:40px;display: inline-block; padding: 10px; background-color: rgba(255,255,255,0.25); border: 1px solid lightgray; border-radius: 4px; font-family:Monospace; font-size:12px","font-size:11px",f.element?f.element:""):console.error(k)}}function G(a,c,d){return d?u("return "+
d,a,null,{element:c,type:"HypeReactiveScope"}):null}function H(a,c){if(!c)return null;const d=c.closest("[data-scope]");if(d){const f=document.getElementById(a.documentId());if(f&&f.contains(d))return G(a,c,d.getAttribute("data-scope"))}return null}function w(a,c,d){const f=g("scopeSymbol"),k=f.length;let b=null;a=a.trim();a.startsWith(f)?(a=a.slice(k),b=H(c,d)):a.includes(f)&&(b=a.slice(0,a.indexOf(f)),b=G(c,d,b),a=a.slice(a.indexOf(f)+k));return{value:a,scope:b}}function I(a,c,d){return a.replace(/{{([\s\S]*?)}}/g,
function(f,k){k=k.trim();if("\\"===f.charAt(0))return f.substring(1);try{const b=w(k,c,d);let e=u("return "+b.value,c,b.scope,{element:d,type:"HypeReactiveTemplate"});return void 0!==e?e:""}catch(b){return""}})}function K(a){let c=document.getElementById(a.currentSceneId()),d=r.get(a)||new Map;c.querySelectorAll("[data-content-template]").forEach(function(f){const k=f.getAttribute("data-content-template"),b=f.innerHTML;k&&!d.has(k)?d.set(k,b):k||d.has(f)||d.set(f,b)});r.set(a,d)}function L(a){x.set(a,
a.customData||{});Object.defineProperty(a,"customData",{get:function(){return x.get(a)},set:function(c){c=A(c,a.refreshReactiveContentDebounced);x.set(a,c);g("debounceCustomDataUpdate")?a.refreshReactiveContentDebounced():a.refreshReactiveContent()}})}function M(a,c,d){!1==="HypeActionEvents"in window&&(c=d.customBehaviorName,"#"!=c.charAt(0)&&/[;=()]/.test(c)&&u(c,a,a.customData))}const J=-1!=window.location.href.indexOf("/Hype/Scratch/HypeScratch."),x=new WeakMap,E=new WeakMap;let v={scopeSymbol:"\u21e2",
visibilitySymbol:"\ud83d\udc41\ufe0f",effectSymbol:"\u26a1\ufe0f",templateSymbol:"\ud83d\udcdd",debounceCustomDataUpdate:!0,visibilityMode:"auto",debug:!1,trackRedraws:!1,redrawHighlightDuration:250};J&&Object.assign(v,{highlightReactiveContent:!0,highlightVisibilityData:!0,highlightVisibilityArea:!0,highlightActionData:!0,highlightScopeData:!0,highlightTemplateData:!0});const B=Symbol("isProxy"),r=new WeakMap;!1==="HYPE_eventListeners"in window&&(window.HYPE_eventListeners=[]);window.HYPE_eventListeners.push({type:"HypeDocumentLoad",
callback:function(a,c,d){function f(b,e,l,n,h){(n=b.closest("["+l+"-action]"))&&u(n.getAttribute(l+"-action"),a,null,{element:b,type:e});if((n=b.closest("["+l+"-behavior]"))&&!k[n.id]){k[n.id]=!0;let m=n.getAttribute(l+"-behavior");C(function(){a.triggerCustomBehaviorNamed(m)})()}}let k={};a.refreshReactiveContent=function(b,e,l,n){void 0===b||void 0===e||/[;=()]/.test(e)||a.triggerCustomBehaviorNamed(z(n._key,b)+" equals "+("string"===typeof e?'"'+e+'"':e));void 0!==b&&(g("customDataUpdate")&&g("customDataUpdate")(b,
e,l,n),a.customDataUpdate&&a.customDataUpdate(b,e,l,n),a.triggerCustomBehaviorNamed("customData was changed"),a.triggerCustomBehaviorNamed(z(n._key,b)+" was updated"));e=document.getElementById(a.currentSceneId());k={};e.querySelectorAll("[data-visibility], [data-content], [data-effect], [data-content-template]").forEach(function(h){var m=h.getAttribute("data-content"),q=h.getAttribute("data-visibility"),p=h.getAttribute("data-effect"),t=h.hasAttribute("data-content-template");q&&(q=w(q,a,h),q=u("return "+
q.value,a,q.scope,{element:h,type:"HypeReactiveVisibility"}),"none"==h.style.display&&(h.style.display="block"),q=q?"visible":"hidden",q!==h.style.visibility&&(h.style.visibility=q,b&&f(h,"HypeReactiveVisibilityChanged","data-visibility-changed",!0,!0)));p&&(p=w(p,a,h),u(p.value,a,p.scope,{element:h,type:"HypeReactiveEffect"}));m?(m=w(m,a,h),m=u("return "+m.value,a,m.scope,{element:h,type:"HypeReactiveContent"}),null!==m&&(p=document.createElement("div"),(t=m instanceof HTMLElement||m instanceof DocumentFragment)?
p.appendChild(m.cloneNode(!0)):(m=void 0!==m?m:"",p.innerHTML=m),p=p.innerHTML,p!==h.innerHTML&&(t?(h.innerHTML="",h.appendChild(m)):h.innerHTML=p,D(h),b&&f(h,"HypeReactiveContentChanged","data-content-changed",!0,!0)))):t&&(m=h.getAttribute("data-content-template"),t=r.get(a)||new Map,(m=m?t.get(m):t.get(h))?(m=I(m,a,h),t=document.createElement("div"),t.innerHTML=m,m=t.innerHTML,m!==h.innerHTML&&(h.innerHTML=m,D(h),b&&f(h,"HypeReactiveTemplateChanged","data-content-template-changed",!0,!0))):h.innerHTML=
"")});!1!=="HypeDataMagic"in window&&HypeDataMagic.getDefault("refreshOnCustomData")&&a.refresh()};a.refreshReactiveContentDebounced=C(a.refreshReactiveContent);a.resolveClosestScope=function(b){return H(a,b)};a.enableReactiveCustomData=function(b){const e=x.get(a)||{};a.customData=Object.assign(e,b||{})};a.parseTemplate=function(b,e){return I(b,a,e||c)};a.setContentTemplateByName=function(b,e,l=!0){let n=r.get(a)||new Map;n.set(b,e);r.set(a,n);l&&a.refreshReactiveContentDebounced()};a.setContentTemplates=
function(b,e=!0){if(b&&"object"===typeof b){for(let l in b)b.hasOwnProperty(l)&&a.setContentTemplateByName(l,b[l],!1);e&&a.refreshReactiveContentDebounced()}};a.flushContentTemplateByName=function(b,e=!0){const l=r.get(a);l&&b&&(l.delete(b),r.set(a,l),e&&a.refreshReactiveContentDebounced())};a.flushContentTemplates=function(b=!0){const e=r.get(a);e&&(e.clear(),r.set(a,e),b&&a.refreshReactiveContentDebounced())};L(a);a.enableReactiveCustomData(g("customData")||{});a.functions().HypeReactiveContent&&
a.functions().HypeReactiveContent(a,c,d)}});window.HYPE_eventListeners.push({type:"HypeScenePrepareForDisplay",callback:function(a,c,d){K(a);a.refreshReactiveContent()}});!1==="HypeActionEvents"in window&&window.HYPE_eventListeners.push({type:"HypeTriggerCustomBehavior",callback:M});J?window.addEventListener("DOMContentLoaded",function(a){g("highlightReactiveContent")&&(a=["[data-scope] [data-content*\x3d"+g("scopeSymbol")+"],[data-scope] [data-effect*\x3d"+g("scopeSymbol")+"],[data-scope] [data-visibility*\x3d"+
g("scopeSymbol")+"]{--data-reactive-color: #ffcccc}","[data-content], [data-effect], [data-visibility], [data-content-template]{--data-reactive-color: #f8d54f}"],document.documentElement.style.setProperty("--data-reactive-color","#f8d54f"),g("highlightActionData")&&(a=a.concat(["[data-content]{outline:1px dashed var(--data-reactive-color);position:relative}","[data-content]::before{content:attr(data-content);font-family:Helvetica,Arial;line-height:11px;font-size:9px;font-weight:normal;padding:2px 5px;white-space:nowrap;max-height:16px;color:#000;text-align:center;background-color:var(--data-reactive-color);position:absolute;top:-15px;left:-1px;border-top-right-radius:.2rem;border-top-left-radius:.2rem;}",
"[data-effect]::before{content:'"+g("effectSymbol")+" ' attr(data-effect);font-family:Helvetica,Arial;line-height:11px;font-size:9px;font-weight:normal;padding:2px 5px;white-space:nowrap;max-height:16px;color:#000;text-align:center;background-color:var(--data-reactive-color);position:absolute;top:-15px;left:-1px;border-top-right-radius:.2rem;border-top-left-radius:.2rem;}","[data-content][data-effect]::before{content: attr(data-content) ' "+g("effectSymbol")+" ' attr(data-effect)}"])),g("highlightTemplateData")&&
(a=a.concat(["[data-content-template]{outline:1px dashed var(--data-reactive-color);position:relative}","[data-content-template]::before{content:'"+g("templateSymbol")+" ' attr(data-content-template);font-family:Helvetica,Arial;line-height:11px;font-size:9px;font-weight:normal;padding:2px 5px;white-space:nowrap;max-height:16px;color:#000;text-align:center;background-color:var(--data-reactive-color);position:absolute;top:-15px;left:-1px;border-top-right-radius:.2rem;border-top-left-radius:.2rem;}"])),
g("highlightVisibilityData")&&(a=a.concat(["[data-visibility]::before{content:'"+g("visibilitySymbol")+" ' attr(data-visibility);font-family:Helvetica,Arial;line-height:11px;font-size:9px;font-weight:normal;padding:2px 5px;white-space:nowrap;max-height:16px;color:#000;text-align:center;background-color:var(--data-reactive-color);position:absolute;top:-15px;left:-1px;border-top-right-radius:.2rem;border-top-left-radius:.2rem;}"])),g("highlightScopeData")&&(a=a.concat(["[data-scope]{--data-reactive-color:#ffcccc; outline:1px dashed var(--data-reactive-color);}",
"[data-scope]::after{content:attr(data-scope);font-family:Helvetica,Arial;line-height:11px;font-size:9px;font-weight:normal;padding:2px 5px;white-space:nowrap;max-height:16px;color:#000;text-align:center;background-color:var(--data-reactive-color);position:absolute;bottom:-15px;left:-1px;border-bottom-right-radius:.2rem;border-bottom-left-radius:.2rem}"])),g("highlightActionData")&&g("highlightVisibilityData")&&(a=a.concat(["[data-content][data-visibility]:not([data-effect])::before{content: attr(data-content) ' "+
g("visibilitySymbol")+" ' attr(data-visibility)}","[data-effect][data-visibility]:not([data-content])::before{content: ' "+g("effectSymbol")+" ' attr(data-effect) ' "+g("visibilitySymbol")+" ' attr(data-visibility)}","[data-content][data-effect][data-visibility]::before{content: attr(data-content)  ' "+g("effectSymbol")+" ' attr(data-effect) ' "+g("visibilitySymbol")+" ' attr(data-visibility)}"])),g("highlightVisibilityArea")&&(a=a.concat(["[data-visibility]:not([data-scope])::after {content:'';position: absolute;top: 0;left: 0;width: 100%;height: 100%;background-image:repeating-linear-gradient(45deg,transparent,transparent 10px,var(--data-reactive-color) 10px,var(--data-reactive-color) 20px);opacity: .1;}"])),
a.forEach(c=>document.styleSheets[0].insertRule(c,0)))}):window.addEventListener("DOMContentLoaded",function(a){a=g("visibilityMode");let c=[];y()&&c.push(".hype-reactive-redraw-overlay {box-sizing: border-box;background-color: rgba(255, 0, 0, 0.2);border: 1px solid rgba(255, 0, 0, 0.5);}");switch(a){case "auto":c.push('[data-visibility][style*\x3d"visibility: hidden"] [data-visibility] { visibility: hidden !important; }');break;case "manual":c.push('[style*\x3d"visibility: hidden"] .inheritVisibility { visibility: hidden !important; }',
'.propagateVisibility[data-visibility][style*\x3d"visibility: hidden"] [data-visibility] { visibility: hidden !important; }')}c.forEach(d=>document.styleSheets[0].insertRule(d,0))});return{version:"1.6.1",setDefault:function(a,c){"object"==typeof a?v=a:v[a]=c},getDefault:g,enableReactiveObject:A,disableReactiveObject:F,debounceByRequestFrame:C}}());
