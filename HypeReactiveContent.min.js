/*
 Hype Reactive Content 1.5.1
copyright (c) 2025 Max Ziebell, (https://maxziebell.de). MIT-license
*/
'use strict';!1==="HypeReactiveContent"in window&&(window.HypeReactiveContent=function(){function D(a){g("trackRedraws")&&y()&&requestAnimationFrame(()=>{if(a.isConnected){var b=a.getBoundingClientRect();if(0!==b.width||0!==b.height){var c=document.createElement("div");c.className="hype-reactive-redraw-overlay";c.style.position="absolute";c.style.pointerEvents="none";c.style.zIndex="9999";c.style.top=window.scrollY+b.top+"px";c.style.left=window.scrollX+b.left+"px";c.style.width=b.width+"px";c.style.height=
b.height+"px";document.body.appendChild(c);setTimeout(()=>{c&&c.parentNode&&c.parentNode.removeChild(c)},g("redrawHighlightDuration"))}}})}function y(){return-1!=window.location.href.indexOf("127.0.0.1:")&&-1!=window.location.href.indexOf("/preview/")}function g(a){return a?v[a]:v}function z(a,b){return a?a+"."+b:b}function A(a,b,c){c=c||"";return null==a||a[B]?a:new Proxy(a,{get:function(e,l,d){if("_key"===l)return c;if(l===B)return!0;e=Reflect.get(e,l,d);return"object"===typeof e?A(e,b,z(c,l)):
e},set:function(e,l,d,f){const m=Reflect.set(e,l,d,f);b(l,d,e,f);return m}})}function E(a){if(!a[B])return a;const b={};for(const c in a)if(a.hasOwnProperty(c)){const e=a[c];b[c]="object"===typeof e?E(e):e}return b}function C(a){return function(){if(!a.timeout){var b=arguments;a.timeout=requestAnimationFrame(function(){a.apply(this,b);a.timeout=null}.bind(this))}}}function u(a,b,c,e){if(c){if("object"!==typeof c)return null}else{if(void 0===c)return null;c=b.customData}e=e||{};if(!1!=="HypeActionEvents"in
window)return b.triggerAction(a,{element:e.element,event:{type:e.type},scope:c});try{let l=new Proxy(Object.assign({element:e.element,$elm:e.element},b),{set(d,f,m,n){return Reflect.get(d,f,n)?Reflect.set(d,f,m,n):Reflect.set(c,f,m)},get(d,f,m){return(d=Reflect.get(d,f,m))?d:Reflect.get(c,f)},has(d,f,m){return d.hasOwnProperty(f)||window[f]?Reflect.has(d,f,m):!0}});return(new Function("$context","with($context){ "+a+"}"))(l)}catch(l){g("debug")||y()?console.error("%c"+(e.errorMsg||"HypeReactiveContent Error")+
"%c"+(e.errorMsg?"":" version "+HypeReactiveContent.version)+"\n\n%c"+a+(e.omitError?"":"%c\n\n"+l+"\n\n"),"font-size:12px; font-weight:bold","font-size:8px","min-height:40px;display: inline-block; padding: 10px; background-color: rgba(255,255,255,0.25); border: 1px solid lightgray; border-radius: 4px; font-family:Monospace; font-size:12px","font-size:11px",e.element?e.element:""):console.error(l)}}function F(a,b,c){return c?u("return "+c,a,null,{element:b,type:"HypeReactiveScope"}):null}function G(a,
b){let c=b.closest("[data-scope]");return c?F(a,b,c.getAttribute("data-scope")):null}function w(a,b,c){const e=g("scopeSymbol"),l=e.length;let d=null;a=a.trim();a.startsWith(e)?(a=a.slice(l),d=G(b,c)):a.includes(e)&&(d=a.slice(0,a.indexOf(e)),d=F(b,c,d),a=a.slice(a.indexOf(e)+l));return{value:a,scope:d}}function I(a,b,c){return a.replace(/{{\s*([^{}\s]+)\s*}}/g,function(e,l){e=w(l,b,c);e=u("return "+e.value,b,e.scope,{element:c,type:"HypeReactiveTemplate"});return void 0!==e?e:""})}function J(a){let b=
document.getElementById(a.currentSceneId()),c=r.get(a)||new Map;b.querySelectorAll("[data-content-template]").forEach(function(e){const l=e.getAttribute("data-content-template"),d=e.innerHTML;l&&!c.has(l)?c.set(l,d):l||c.has(e)||c.set(e,d)});r.set(a,c)}function K(a){x.set(a,a.customData||{});Object.defineProperty(a,"customData",{get:function(){return x.get(a)},set:function(b){b=A(b,a.refreshReactiveContentDebounced);x.set(a,b);g("debounceCustomDataUpdate")?a.refreshReactiveContentDebounced():a.refreshReactiveContent()}})}
function L(a,b,c){!1==="HypeActionEvents"in window&&(b=c.customBehaviorName,"#"!=b.charAt(0)&&/[;=()]/.test(b)&&u(b,a,a.customData))}const H=-1!=window.location.href.indexOf("/Hype/Scratch/HypeScratch."),x=new WeakMap;let v={scopeSymbol:"\u21e2",visibilitySymbol:"\ud83d\udc41\ufe0f",effectSymbol:"\u26a1\ufe0f",templateSymbol:"\ud83d\udcdd",debounceCustomDataUpdate:!0,visibilityMode:"auto",debug:!1,trackRedraws:!1,redrawHighlightDuration:250};H&&(v=Object.assign(v,{highlightReactiveContent:!0,highlightVisibilityData:!0,
highlightVisibilityArea:!0,highlightActionData:!0,highlightScopeData:!0,highlightTemplateData:!0}));let B=Symbol("isProxy");const r=new WeakMap;!1==="HYPE_eventListeners"in window&&(window.HYPE_eventListeners=[]);window.HYPE_eventListeners.push({type:"HypeDocumentLoad",callback:function(a,b,c){function e(d,f,m,n,h){(n=d.closest("["+m+"-action]"))&&u(n.getAttribute(m+"-action"),a,null,{element:d,type:f});if((n=d.closest("["+m+"-behavior]"))&&!l[n.id]){l[n.id]=!0;let k=n.getAttribute(m+"-behavior");
C(function(){a.triggerCustomBehaviorNamed(k)})()}}let l={};a.refreshReactiveContent=function(d,f,m,n){void 0===d||void 0===f||/[;=()]/.test(f)||a.triggerCustomBehaviorNamed(z(n._key,d)+" equals "+("string"===typeof f?'"'+f+'"':f));void 0!==d&&(g("customDataUpdate")&&g("customDataUpdate")(d,f,m,n),a.customDataUpdate&&a.customDataUpdate(d,f,m,n),a.triggerCustomBehaviorNamed("customData was changed"),a.triggerCustomBehaviorNamed(z(n._key,d)+" was updated"));f=document.getElementById(a.currentSceneId());
l={};f.querySelectorAll("[data-visibility], [data-content], [data-effect], [data-content-template]").forEach(function(h){var k=h.getAttribute("data-content"),q=h.getAttribute("data-visibility"),p=h.getAttribute("data-effect"),t=h.hasAttribute("data-content-template");q&&(q=w(q,a,h),q=u("return "+q.value,a,q.scope,{element:h,type:"HypeReactiveVisibility"}),"none"==h.style.display&&(h.style.display="block"),q=q?"visible":"hidden",q!==h.style.visibility&&(h.style.visibility=q,d&&e(h,"HypeReactiveVisibilityChanged",
"data-visibility-changed",!0,!0)));p&&(p=w(p,a,h),u(p.value,a,p.scope,{element:h,type:"HypeReactiveEffect"}));k?(k=w(k,a,h),k=u("return "+k.value,a,k.scope,{element:h,type:"HypeReactiveContent"}),null!==k&&(p=document.createElement("div"),(t=k instanceof HTMLElement||k instanceof DocumentFragment)?p.appendChild(k.cloneNode(!0)):(k=void 0!==k?k:"",p.innerHTML=k),p=p.innerHTML,p!==h.innerHTML&&(t?(h.innerHTML="",h.appendChild(k)):h.innerHTML=p,D(h),d&&e(h,"HypeReactiveContentChanged","data-content-changed",
!0,!0)))):t&&(k=h.getAttribute("data-content-template"),t=r.get(a)||new Map,(k=k?t.get(k):t.get(h))?(k=I(k,a,h),t=document.createElement("div"),t.innerHTML=k,k=t.innerHTML,k!==h.innerHTML&&(h.innerHTML=k,D(h),d&&e(h,"HypeReactiveTemplateChanged","data-content-template-changed",!0,!0))):h.innerHTML="")});!1!=="HypeDataMagic"in window&&HypeDataMagic.getDefault("refreshOnCustomData")&&a.refresh()};a.refreshReactiveContentDebounced=C(a.refreshReactiveContent);a.resolveClosestScope=function(d){return G(a,
d)};a.enableReactiveCustomData=function(d){const f=x.get(a)||{};a.customData=Object.assign(f,d||{})};a.setContentTemplateByName=function(d,f,m=!0){let n=r.get(a)||new Map;n.set(d,f);r.set(a,n);m&&a.refreshReactiveContentDebounced()};a.setContentTemplates=function(d,f=!0){if(d&&"object"===typeof d){for(let m in d)d.hasOwnProperty(m)&&a.setContentTemplateByName(m,d[m],!1);f&&a.refreshReactiveContentDebounced()}};a.flushContentTemplateByName=function(d,f=!0){const m=r.get(a);m&&d&&(m.delete(d),r.set(a,
m),f&&a.refreshReactiveContentDebounced())};a.flushContentTemplates=function(d=!0){const f=r.get(a);f&&(f.clear(),r.set(a,f),d&&a.refreshReactiveContentDebounced())};K(a);a.enableReactiveCustomData(g("customData")||{});a.functions().HypeReactiveContent&&a.functions().HypeReactiveContent(a,b,c)}});window.HYPE_eventListeners.push({type:"HypeScenePrepareForDisplay",callback:function(a,b,c){J(a);a.refreshReactiveContent()}});!1==="HypeActionEvents"in window&&window.HYPE_eventListeners.push({type:"HypeTriggerCustomBehavior",
callback:L});H?window.addEventListener("DOMContentLoaded",function(a){g("highlightReactiveContent")&&(a=["[data-scope] [data-content*\x3d"+g("scopeSymbol")+"],[data-scope] [data-effect*\x3d"+g("scopeSymbol")+"],[data-scope] [data-visibility*\x3d"+g("scopeSymbol")+"]{--data-reactive-color: #ffcccc}","[data-content], [data-effect], [data-visibility], [data-content-template]{--data-reactive-color: #f8d54f}"],document.documentElement.style.setProperty("--data-reactive-color","#f8d54f"),g("highlightActionData")&&
(a=a.concat(["[data-content]{outline:1px dashed var(--data-reactive-color);position:relative}","[data-content]::before{content:attr(data-content);font-family:Helvetica,Arial;line-height:11px;font-size:9px;font-weight:normal;padding:2px 5px;white-space:nowrap;max-height:16px;color:#000;text-align:center;background-color:var(--data-reactive-color);position:absolute;top:-15px;left:-1px;border-top-right-radius:.2rem;border-top-left-radius:.2rem;}","[data-effect]::before{content:'"+g("effectSymbol")+" ' attr(data-effect);font-family:Helvetica,Arial;line-height:11px;font-size:9px;font-weight:normal;padding:2px 5px;white-space:nowrap;max-height:16px;color:#000;text-align:center;background-color:var(--data-reactive-color);position:absolute;top:-15px;left:-1px;border-top-right-radius:.2rem;border-top-left-radius:.2rem;}",
"[data-content][data-effect]::before{content: attr(data-content) ' "+g("effectSymbol")+" ' attr(data-effect)}"])),g("highlightTemplateData")&&(a=a.concat(["[data-content-template]{outline:1px dashed var(--data-reactive-color);position:relative}","[data-content-template]::before{content:'"+g("templateSymbol")+" ' attr(data-content-template);font-family:Helvetica,Arial;line-height:11px;font-size:9px;font-weight:normal;padding:2px 5px;white-space:nowrap;max-height:16px;color:#000;text-align:center;background-color:var(--data-reactive-color);position:absolute;top:-15px;left:-1px;border-top-right-radius:.2rem;border-top-left-radius:.2rem;}"])),
g("highlightVisibilityData")&&(a=a.concat(["[data-visibility]::before{content:'"+g("visibilitySymbol")+" ' attr(data-visibility);font-family:Helvetica,Arial;line-height:11px;font-size:9px;font-weight:normal;padding:2px 5px;white-space:nowrap;max-height:16px;color:#000;text-align:center;background-color:var(--data-reactive-color);position:absolute;top:-15px;left:-1px;border-top-right-radius:.2rem;border-top-left-radius:.2rem;}"])),g("highlightScopeData")&&(a=a.concat(["[data-scope]{--data-reactive-color:#ffcccc; outline:1px dashed var(--data-reactive-color);}",
"[data-scope]::after{content:attr(data-scope);font-family:Helvetica,Arial;line-height:11px;font-size:9px;font-weight:normal;padding:2px 5px;white-space:nowrap;max-height:16px;color:#000;text-align:center;background-color:var(--data-reactive-color);position:absolute;bottom:-15px;left:-1px;border-bottom-right-radius:.2rem;border-bottom-left-radius:.2rem}"])),g("highlightActionData")&&g("highlightVisibilityData")&&(a=a.concat(["[data-content][data-visibility]:not([data-effect])::before{content: attr(data-content) ' "+
g("visibilitySymbol")+" ' attr(data-visibility)}","[data-effect][data-visibility]:not([data-content])::before{content: ' "+g("effectSymbol")+" ' attr(data-effect) ' "+g("visibilitySymbol")+" ' attr(data-visibility)}","[data-content][data-effect][data-visibility]::before{content: attr(data-content)  ' "+g("effectSymbol")+" ' attr(data-effect) ' "+g("visibilitySymbol")+" ' attr(data-visibility)}"])),g("highlightVisibilityArea")&&(a=a.concat(["[data-visibility]:not([data-scope])::after {content:'';position: absolute;top: 0;left: 0;width: 100%;height: 100%;background-image:repeating-linear-gradient(45deg,transparent,transparent 10px,var(--data-reactive-color) 10px,var(--data-reactive-color) 20px);opacity: .1;}"])),
a.forEach(b=>document.styleSheets[0].insertRule(b,0)))}):window.addEventListener("DOMContentLoaded",function(a){a=g("visibilityMode");let b=[];y()&&b.push(".hype-reactive-redraw-overlay {box-sizing: border-box;background-color: rgba(255, 0, 0, 0.2);border: 1px solid rgba(255, 0, 0, 0.5);}");switch(a){case "auto":b.push('[data-visibility][style*\x3d"visibility: hidden"] [data-visibility] { visibility: hidden !important; }');break;case "manual":b.push('[style*\x3d"visibility: hidden"] .inheritVisibility { visibility: hidden !important; }',
'.propagateVisibility[data-visibility][style*\x3d"visibility: hidden"] [data-visibility] { visibility: hidden !important; }')}b.forEach(c=>document.styleSheets[0].insertRule(c,0))});return{version:"1.5.1",setDefault:function(a,b){"object"==typeof a?v=a:v[a]=b},getDefault:g,enableReactiveObject:A,disableReactiveObject:E,debounceByRequestFrame:C}}());
