/*
 Hype Reactive Content 1.7.2
copyright (c) 2025 Max Ziebell, (https://maxziebell.de). MIT-license
*/
'use strict';"HypeReactiveContent"in window===!1&&(window.HypeReactiveContent=function(){function D(a){(p("trackRedraws")||p("forceHighlightBindings"))&&(p("forceHighlightBindings")||E())&&requestAnimationFrame(()=>{if(a.isConnected){var c=a.getBoundingClientRect();if(c.width!==0||c.height!==0){var d=document.createElement("div");d.className="hype-reactive-redraw-overlay";d.style.position="absolute";d.style.pointerEvents="none";d.style.zIndex="9999";d.style.top=window.scrollY+c.top+"px";d.style.left=
window.scrollX+c.left+"px";d.style.width=c.width+"px";d.style.height=c.height+"px";document.body.appendChild(d);setTimeout(()=>{d&&d.parentNode&&d.parentNode.removeChild(d)},p("redrawHighlightDuration"))}}})}function E(){return window.location.href.indexOf("127.0.0.1:")!=-1&&window.location.href.indexOf("/preview/")!=-1}function p(a){return a?v[a]:v}function y(a,c){return a?a+"."+c:c}function F(a,c){if(c&&typeof c==="object")for(const [d,e]of Object.entries(c))(c=a[d])&&typeof c==="object"&&!Array.isArray(c)&&
e&&typeof e==="object"&&!Array.isArray(e)?F(c,e):a[d]=e}function z(a,c,d){d=d||"";if(a==null||a[A])return a;var e=G.get(a);if(e)return e;e=new Proxy(a,{get:function(h,b,f){if(b==="_key")return d;if(b===A)return!0;h=Reflect.get(h,b,f);return typeof h==="object"?z(h,c,y(d,b)):h},set:function(h,b,f,k){const m=Reflect.set(h,b,f,k);c(b,f,h,k);return m}});G.set(a,e);return e}function H(a){if(!a[A])return a;const c={};for(const d in a)if(a.hasOwnProperty(d)){const e=a[d];c[d]=typeof e==="object"?H(e):e}return c}
function B(a){return function(){if(!a.timeout){var c=arguments;a.timeout=requestAnimationFrame(function(){a.apply(this,c);a.timeout=null}.bind(this))}}}function u(a,c,d,e){if(d){if(typeof d!=="object")return null}else{if(d===void 0)return null;d=c.customData}e=e||{};if("HypeActionEvents"in window!==!1)return c.triggerAction(a,{element:e.element,event:{type:e.type},scope:d});try{let h=new Proxy(Object.assign({element:e.element,$elm:e.element},c),{set(b,f,k,m){return Reflect.get(b,f,m)?Reflect.set(b,
f,k,m):Reflect.set(d,f,k)},get(b,f,k){return(b=Reflect.get(b,f,k))?b:Reflect.get(d,f)},has(b,f,k){return b.hasOwnProperty(f)||window[f]?Reflect.has(b,f,k):!0}});return(new Function("$context","with($context){ "+a+"}"))(h)}catch(h){p("debug")||E()?console.error("%c"+(e.errorMsg||"HypeReactiveContent Error")+"%c"+(e.errorMsg?"":" version "+HypeReactiveContent.version)+"\n\n%c"+a+(e.omitError?"":"%c\n\n"+h+"\n\n"),"font-size:12px; font-weight:bold","font-size:8px","min-height:40px;display: inline-block; padding: 10px; background-color: rgba(255,255,255,0.25); border: 1px solid lightgray; border-radius: 4px; font-family:Monospace; font-size:12px",
"font-size:11px",e.element?e.element:""):console.error(h)}}function I(a,c,d){return d?u("return "+d,a,null,{element:c,type:"HypeReactiveScope"}):null}function J(a,c){if(!c)return null;const d=c.closest("[data-scope]");if(d){const e=document.getElementById(a.documentId());if(e&&e.contains(d))return I(a,c,d.getAttribute("data-scope"))}return null}function w(a,c,d){const e=p("scopeSymbol"),h=e.length;let b=null;a=a.trim();a.startsWith(e)?(a=a.slice(h),b=J(c,d)):a.includes(e)&&(b=a.slice(0,a.indexOf(e)),
b=I(c,d,b),a=a.slice(a.indexOf(e)+h));return{value:a,scope:b}}function K(a,c,d){return a.replace(/{{([\s\S]*?)}}/g,function(e,h){h=h.trim();if(e.charAt(0)==="\\")return e.substring(1);try{const b=w(h,c,d);let f=u("return "+b.value,c,b.scope,{element:d,type:"HypeReactiveTemplate"});return f!==void 0?f:""}catch(b){return""}})}function L(a){let c=document.getElementById(a.currentSceneId()),d=r.get(a)||new Map;c.querySelectorAll("[data-content-template]").forEach(function(e){const h=e.getAttribute("data-content-template"),
b=e.innerHTML;h&&!d.has(h)?d.set(h,b):h||d.has(e)||d.set(e,b)});r.set(a,d)}function M(a){x.set(a,a.customData||{});Object.defineProperty(a,"customData",{get:function(){return x.get(a)},set:function(c){c=z(c,a.refreshReactiveContentDebounced);x.set(a,c);p("debounceCustomDataUpdate")?a.refreshReactiveContentDebounced():a.refreshReactiveContent()}})}function N(a,c,d){"HypeActionEvents"in window===!1&&(c=d.customBehaviorName,c.charAt(0)!="#"&&/[;=()]/.test(c)&&u(c,a,a.customData))}const O=window.location.href.indexOf("/Hype/Scratch/HypeScratch.")!=
-1,x=new WeakMap;let C=null;const G=new WeakMap;let v={scopeSymbol:"\u21e2",visibilitySymbol:"\ud83d\udc41\ufe0f",effectSymbol:"\u26a1\ufe0f",templateSymbol:"\ud83d\udcdd",debounceCustomDataUpdate:!0,visibilityMode:"auto",debug:!1,trackRedraws:!1,redrawHighlightDuration:250,forceHighlightBindings:!1};O&&Object.assign(v,{highlightReactiveContent:!0,highlightVisibilityData:!0,highlightVisibilityArea:!0,highlightActionData:!0,highlightScopeData:!0,highlightTemplateData:!0});const A=Symbol("isProxy"),
r=new WeakMap;"HYPE_eventListeners"in window===!1&&(window.HYPE_eventListeners=[]);window.HYPE_eventListeners.push({type:"HypeDocumentLoad",callback:function(a,c,d){function e(b,f,k,m,g){(m=b.closest("["+k+"-action]"))&&u(m.getAttribute(k+"-action"),a,null,{element:b,type:f});if((m=b.closest("["+k+"-behavior]"))&&!h[m.id]){h[m.id]=!0;let l=m.getAttribute(k+"-behavior");B(function(){a.triggerCustomBehaviorNamed(l)})()}}let h={};a.refreshReactiveContent=function(b,f,k,m){b===void 0||f===void 0||/[;=()]/.test(f)||
typeof f==="object"||a.triggerCustomBehaviorNamed(y(m._key,b)+" equals "+(typeof f==="string"?'"'+f+'"':f));b!==void 0&&(p("customDataUpdate")&&p("customDataUpdate")(b,f,k,m),a.customDataUpdate&&a.customDataUpdate(b,f,k,m),a.triggerCustomBehaviorNamed("customData was changed"),a.triggerCustomBehaviorNamed(y(m._key,b)+" was updated"));f=document.getElementById(a.currentSceneId());h={};f.querySelectorAll("[data-visibility], [data-content], [data-effect], [data-content-template]").forEach(function(g){C=
g;var l=g.getAttribute("data-content"),q=g.getAttribute("data-visibility"),n=g.getAttribute("data-effect"),t=g.hasAttribute("data-content-template");q&&(q=w(q,a,g),q=u("return "+q.value,a,q.scope,{element:g,type:"HypeReactiveVisibility"}),g.style.display=="none"&&(g.style.display="block"),q=q?"visible":"hidden",q!==g.style.visibility&&(g.style.visibility=q,b&&e(g,"HypeReactiveVisibilityChanged","data-visibility-changed",!0,!0)));n&&(n=w(n,a,g),u(n.value,a,n.scope,{element:g,type:"HypeReactiveEffect"}));
l?(l=w(l,a,g),l=u("return "+l.value,a,l.scope,{element:g,type:"HypeReactiveContent"}),l!==null&&(n=document.createElement("div"),(t=l instanceof HTMLElement||l instanceof DocumentFragment)?n.appendChild(l.cloneNode(!0)):(l=l!==void 0?l:"",n.innerHTML=l),n=n.innerHTML,n!==g.innerHTML&&(t?(g.innerHTML="",g.appendChild(l)):g.innerHTML=n,D(g),b&&e(g,"HypeReactiveContentChanged","data-content-changed",!0,!0)))):t&&(l=g.getAttribute("data-content-template"),t=r.get(a)||new Map,(l=l?t.get(l):t.get(g))?(l=
K(l,a,g),t=document.createElement("div"),t.innerHTML=l,l=t.innerHTML,l!==g.innerHTML&&(g.innerHTML=l,D(g),b&&e(g,"HypeReactiveTemplateChanged","data-content-template-changed",!0,!0))):g.innerHTML="")});C=null;"HypeDataMagic"in window!==!1&&HypeDataMagic.getDefault("refreshOnCustomData")&&a.refresh()};a.refreshReactiveContentDebounced=B(a.refreshReactiveContent);a.resolveClosestScope=function(b){return J(a,b)};a.enableReactiveCustomData=function(b){const f=x.get(a)||{};F(f,b||{});a.customData=f};a.parseTemplate=
function(b,f){return K(b,a,f||c)};a.setContentTemplateByName=function(b,f,k=!0){let m=r.get(a)||new Map;m.set(b,f);r.set(a,m);k&&a.refreshReactiveContentDebounced()};a.setContentTemplates=function(b,f=!0){if(b&&typeof b==="object"){for(let k in b)b.hasOwnProperty(k)&&a.setContentTemplateByName(k,b[k],!1);f&&a.refreshReactiveContentDebounced()}};a.flushContentTemplateByName=function(b,f=!0){const k=r.get(a);k&&b&&(k.delete(b),r.set(a,k),f&&a.refreshReactiveContentDebounced())};a.flushContentTemplates=
function(b=!0){const f=r.get(a);f&&(f.clear(),r.set(a,f),b&&a.refreshReactiveContentDebounced())};M(a);a.enableReactiveCustomData(p("customData")||{});a.functions().HypeReactiveContent&&a.functions().HypeReactiveContent(a,c,d)}});window.HYPE_eventListeners.push({type:"HypeScenePrepareForDisplay",callback:function(a,c,d){L(a);a.refreshReactiveContent()}});"HypeActionEvents"in window===!1&&window.HYPE_eventListeners.push({type:"HypeTriggerCustomBehavior",callback:N});return{version:"1.7.2",setDefault:function(a,
c){typeof a=="object"?v=a:v[a]=c},getDefault:p,get currentElement(){return C},enableReactiveObject:z,disableReactiveObject:H,debounceByRequestFrame:B,enableBindingHighlights:function(){},disableBindingHighlights:function(){}}}());
