/*
 Hype Reactive Content 1.6.0
copyright (c) 2025 Max Ziebell, (https://maxziebell.de). MIT-license
*/
'use strict';!1==="HypeReactiveContent"in window&&(window.HypeReactiveContent=function(){function D(a){p("trackRedraws")&&y()&&requestAnimationFrame(()=>{if(a.isConnected){var d=a.getBoundingClientRect();if(0!==d.width||0!==d.height){var c=document.createElement("div");c.className="hype-reactive-redraw-overlay";c.style.position="absolute";c.style.pointerEvents="none";c.style.zIndex="9999";c.style.top=window.scrollY+d.top+"px";c.style.left=window.scrollX+d.left+"px";c.style.width=d.width+"px";c.style.height=
d.height+"px";document.body.appendChild(c);setTimeout(()=>{c&&c.parentNode&&c.parentNode.removeChild(c)},p("redrawHighlightDuration"))}}})}function y(){return-1!=window.location.href.indexOf("127.0.0.1:")&&-1!=window.location.href.indexOf("/preview/")}function p(a){return a?v[a]:v}function z(a,d){return a?a+"."+d:d}function A(a,d,c){c=c||"";if(null==a||a[B])return a;var f=E.get(a);if(f)return f;f=new Proxy(a,{get:function(h,b,e){if("_key"===b)return c;if(b===B)return!0;h=Reflect.get(h,b,e);return"object"===
typeof h?A(h,d,z(c,b)):h},set:function(h,b,e,k){const m=Reflect.set(h,b,e,k);d(b,e,h,k);return m}});E.set(a,f);return f}function F(a){if(!a[B])return a;const d={};for(const c in a)if(a.hasOwnProperty(c)){const f=a[c];d[c]="object"===typeof f?F(f):f}return d}function C(a){return function(){if(!a.timeout){var d=arguments;a.timeout=requestAnimationFrame(function(){a.apply(this,d);a.timeout=null}.bind(this))}}}function u(a,d,c,f){if(c){if("object"!==typeof c)return null}else{if(void 0===c)return null;
c=d.customData}f=f||{};if(!1!=="HypeActionEvents"in window)return d.triggerAction(a,{element:f.element,event:{type:f.type},scope:c});try{let h=new Proxy(Object.assign({element:f.element,$elm:f.element},d),{set(b,e,k,m){return Reflect.get(b,e,m)?Reflect.set(b,e,k,m):Reflect.set(c,e,k)},get(b,e,k){return(b=Reflect.get(b,e,k))?b:Reflect.get(c,e)},has(b,e,k){return b.hasOwnProperty(e)||window[e]?Reflect.has(b,e,k):!0}});return(new Function("$context","with($context){ "+a+"}"))(h)}catch(h){p("debug")||
y()?console.error("%c"+(f.errorMsg||"HypeReactiveContent Error")+"%c"+(f.errorMsg?"":" version "+HypeReactiveContent.version)+"\n\n%c"+a+(f.omitError?"":"%c\n\n"+h+"\n\n"),"font-size:12px; font-weight:bold","font-size:8px","min-height:40px;display: inline-block; padding: 10px; background-color: rgba(255,255,255,0.25); border: 1px solid lightgray; border-radius: 4px; font-family:Monospace; font-size:12px","font-size:11px",f.element?f.element:""):console.error(h)}}function G(a,d,c){return c?u("return "+
c,a,null,{element:d,type:"HypeReactiveScope"}):null}function H(a,d){let c=d.closest("[data-scope]");return c?G(a,d,c.getAttribute("data-scope")):null}function w(a,d,c){const f=p("scopeSymbol"),h=f.length;let b=null;a=a.trim();a.startsWith(f)?(a=a.slice(h),b=H(d,c)):a.includes(f)&&(b=a.slice(0,a.indexOf(f)),b=G(d,c,b),a=a.slice(a.indexOf(f)+h));return{value:a,scope:b}}function I(a,d,c){return a.replace(/{{([\s\S]*?)}}/g,function(f,h){h=h.trim();if("\\"===f.charAt(0))return f.substring(1);try{const b=
w(h,d,c);let e=u("return "+b.value,d,b.scope,{element:c,type:"HypeReactiveTemplate"});return void 0!==e?e:""}catch(b){return""}})}function J(a){let d=document.getElementById(a.currentSceneId()),c=r.get(a)||new Map;d.querySelectorAll("[data-content-template]").forEach(function(f){const h=f.getAttribute("data-content-template"),b=f.innerHTML;h&&!c.has(h)?c.set(h,b):h||c.has(f)||c.set(f,b)});r.set(a,c)}function K(a){x.set(a,a.customData||{});Object.defineProperty(a,"customData",{get:function(){return x.get(a)},
set:function(d){d=A(d,a.refreshReactiveContentDebounced);x.set(a,d);p("debounceCustomDataUpdate")?a.refreshReactiveContentDebounced():a.refreshReactiveContent()}})}function L(a,d,c){!1==="HypeActionEvents"in window&&(d=c.customBehaviorName,"#"!=d.charAt(0)&&/[;=()]/.test(d)&&u(d,a,a.customData))}const x=new WeakMap,E=new WeakMap;let v={scopeSymbol:"\u21e2",visibilitySymbol:"\ud83d\udc41\ufe0f",effectSymbol:"\u26a1\ufe0f",templateSymbol:"\ud83d\udcdd",debounceCustomDataUpdate:!0,visibilityMode:"auto",
debug:!1,trackRedraws:!1,redrawHighlightDuration:250};const B=Symbol("isProxy"),r=new WeakMap;!1==="HYPE_eventListeners"in window&&(window.HYPE_eventListeners=[]);window.HYPE_eventListeners.push({type:"HypeDocumentLoad",callback:function(a,d,c){function f(b,e,k,m,g){(m=b.closest("["+k+"-action]"))&&u(m.getAttribute(k+"-action"),a,null,{element:b,type:e});if((m=b.closest("["+k+"-behavior]"))&&!h[m.id]){h[m.id]=!0;let l=m.getAttribute(k+"-behavior");C(function(){a.triggerCustomBehaviorNamed(l)})()}}
let h={};a.refreshReactiveContent=function(b,e,k,m){void 0===b||void 0===e||/[;=()]/.test(e)||a.triggerCustomBehaviorNamed(z(m._key,b)+" equals "+("string"===typeof e?'"'+e+'"':e));void 0!==b&&(p("customDataUpdate")&&p("customDataUpdate")(b,e,k,m),a.customDataUpdate&&a.customDataUpdate(b,e,k,m),a.triggerCustomBehaviorNamed("customData was changed"),a.triggerCustomBehaviorNamed(z(m._key,b)+" was updated"));e=document.getElementById(a.currentSceneId());h={};e.querySelectorAll("[data-visibility], [data-content], [data-effect], [data-content-template]").forEach(function(g){var l=
g.getAttribute("data-content"),q=g.getAttribute("data-visibility"),n=g.getAttribute("data-effect"),t=g.hasAttribute("data-content-template");q&&(q=w(q,a,g),q=u("return "+q.value,a,q.scope,{element:g,type:"HypeReactiveVisibility"}),"none"==g.style.display&&(g.style.display="block"),q=q?"visible":"hidden",q!==g.style.visibility&&(g.style.visibility=q,b&&f(g,"HypeReactiveVisibilityChanged","data-visibility-changed",!0,!0)));n&&(n=w(n,a,g),u(n.value,a,n.scope,{element:g,type:"HypeReactiveEffect"}));l?
(l=w(l,a,g),l=u("return "+l.value,a,l.scope,{element:g,type:"HypeReactiveContent"}),null!==l&&(n=document.createElement("div"),(t=l instanceof HTMLElement||l instanceof DocumentFragment)?n.appendChild(l.cloneNode(!0)):(l=void 0!==l?l:"",n.innerHTML=l),n=n.innerHTML,n!==g.innerHTML&&(t?(g.innerHTML="",g.appendChild(l)):g.innerHTML=n,D(g),b&&f(g,"HypeReactiveContentChanged","data-content-changed",!0,!0)))):t&&(l=g.getAttribute("data-content-template"),t=r.get(a)||new Map,(l=l?t.get(l):t.get(g))?(l=
I(l,a,g),t=document.createElement("div"),t.innerHTML=l,l=t.innerHTML,l!==g.innerHTML&&(g.innerHTML=l,D(g),b&&f(g,"HypeReactiveTemplateChanged","data-content-template-changed",!0,!0))):g.innerHTML="")});!1!=="HypeDataMagic"in window&&HypeDataMagic.getDefault("refreshOnCustomData")&&a.refresh()};a.refreshReactiveContentDebounced=C(a.refreshReactiveContent);a.resolveClosestScope=function(b){return H(a,b)};a.enableReactiveCustomData=function(b){const e=x.get(a)||{};a.customData=Object.assign(e,b||{})};
a.setContentTemplateByName=function(b,e,k=!0){let m=r.get(a)||new Map;m.set(b,e);r.set(a,m);k&&a.refreshReactiveContentDebounced()};a.setContentTemplates=function(b,e=!0){if(b&&"object"===typeof b){for(let k in b)b.hasOwnProperty(k)&&a.setContentTemplateByName(k,b[k],!1);e&&a.refreshReactiveContentDebounced()}};a.flushContentTemplateByName=function(b,e=!0){const k=r.get(a);k&&b&&(k.delete(b),r.set(a,k),e&&a.refreshReactiveContentDebounced())};a.flushContentTemplates=function(b=!0){const e=r.get(a);
e&&(e.clear(),r.set(a,e),b&&a.refreshReactiveContentDebounced())};K(a);a.enableReactiveCustomData(p("customData")||{});a.functions().HypeReactiveContent&&a.functions().HypeReactiveContent(a,d,c)}});window.HYPE_eventListeners.push({type:"HypeScenePrepareForDisplay",callback:function(a,d,c){J(a);a.refreshReactiveContent()}});!1==="HypeActionEvents"in window&&window.HYPE_eventListeners.push({type:"HypeTriggerCustomBehavior",callback:L});window.addEventListener("DOMContentLoaded",function(a){a=p("visibilityMode");
let d=[];y()&&d.push(".hype-reactive-redraw-overlay {box-sizing: border-box;background-color: rgba(255, 0, 0, 0.2);border: 1px solid rgba(255, 0, 0, 0.5);}");switch(a){case "auto":d.push('[data-visibility][style*\x3d"visibility: hidden"] [data-visibility] { visibility: hidden !important; }');break;case "manual":d.push('[style*\x3d"visibility: hidden"] .inheritVisibility { visibility: hidden !important; }','.propagateVisibility[data-visibility][style*\x3d"visibility: hidden"] [data-visibility] { visibility: hidden !important; }')}d.forEach(c=>
document.styleSheets[0].insertRule(c,0))});return{version:"1.6.0",setDefault:function(a,d){"object"==typeof a?v=a:v[a]=d},getDefault:p,enableReactiveObject:A,disableReactiveObject:F,debounceByRequestFrame:C}}());
